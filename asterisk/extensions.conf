; =============================================================================
; Taxi AI - Asterisk Extensions Configuration
; Compatible with Asterisk 20.6+
; =============================================================================

[general]
static=yes
writeprotect=no

; =============================================================================
; INCOMING WHATSAPP/META CALLS - Forward to SIP
; =============================================================================
[from-whatsapp]
exten => _+X.,1,NoOp(Incoming WhatsApp Call from: ${CALLERID(num)})
 same => n,Set(CHANNEL(hangup_handler_push)=handler,cleanup,1)
 same => n,Answer()
 same => n,Progress()
 same => n,Wait(1)
 
 ; Forward to SIP extension at max.m1online.net
 same => n,NoOp(Forwarding to SIP: max201@max.m1online.net)
 same => n,Dial(SIP/max201@max.m1online.net,60,tT)
 same => n,Hangup()

; =============================================================================
; HANGUP HANDLER
; =============================================================================
[handler]
exten => cleanup,1,NoOp(Cleaning up AI Socket)
 same => n,Return()

; =============================================================================
; INTERNAL TEST CALLS (Dial 100 from SIP phone)
; =============================================================================
[from-internal]
exten => 100,1,NoOp(Internal Test Call)
 same => n,Set(CHANNEL(hangup_handler_push)=handler,cleanup,1)
 same => n,Answer()
 same => n,Progress()
 same => n,Wait(1)
 same => n,Dial(SIP/max201@max.m1online.net,60,tT)
 same => n,Hangup()